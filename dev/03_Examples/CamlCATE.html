<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CamlCATE â€“ CaML - Causal ML</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../03_Examples/FastOLS.html" rel="next">
<link href="../assets/logo_no_text.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-90533376958dee2a2f0107557869354e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/javascript">
    // Enhanced Version Switcher for Quarto Documentation
    // Provides a floating version selector with hover functionality

    (function () {
        "use strict";

        // Configuration
        const CONFIG = {
            containerId: "version-switcher",
            position: { bottom: "20px", right: "20px" },
            versionsJsonPath: getVersionsJsonPath(),
            currentVersionText: getCurrentVersionFromPath(),
        };

        // Utility function to get the correct path to versions.json
        function getVersionsJsonPath() {
            const path = window.location.pathname;
            const segments = path.split("/").filter(Boolean);

            return "/versions.json";
        }

        // Detect current version from URL path
        function getCurrentVersionFromPath() {
            const path = window.location.pathname;
            const versionMatch = path.match(/\/v[\d\.\-\w]+\//);

            if (versionMatch) {
                return versionMatch[0].replace(/\//g, "");
            }
            if (path.includes("dev")) {
                return "dev";
            }

            return "latest";
        }

        // Create version switcher HTML structure
        function createVersionSwitcher(versions) {
            const container = document.createElement("div");
            container.id = CONFIG.containerId;
            container.setAttribute("role", "navigation");
            container.setAttribute("aria-label", "Version selector");

            // Create toggle button
            const toggleButton = document.createElement("button");
            toggleButton.className = "version-toggle-btn";
            toggleButton.setAttribute("aria-haspopup", "true");
            toggleButton.setAttribute("aria-expanded", "false");
            toggleButton.setAttribute(
                "aria-label",
                "Select documentation version",
            );

            const currentVersionLabel = versions.find(
                (v) =>
                    v.text === CONFIG.currentVersionText ||
                    (v.text === "latest" &&
                        CONFIG.currentVersionText === "latest"),
            );

            toggleButton.innerHTML = `
            <span class="version-icon">ðŸ“š</span>
            <span class="version-text">${currentVersionLabel ? currentVersionLabel.text : "Version"}</span>
            <span class="version-arrow">â–¼</span>
        `;

            // Create dropdown menu
            const dropdown = document.createElement("div");
            dropdown.className = "version-dropdown";
            dropdown.setAttribute("role", "menu");
            dropdown.style.display = "none";

            // Create version list
            const versionList = document.createElement("ul");
            versionList.className = "version-list";
            versionList.setAttribute("role", "none");

            versions.forEach((version, index) => {
                const listItem = document.createElement("li");
                listItem.setAttribute("role", "none");

                const link = document.createElement("a");
                link.className = "version-link";
                link.href = version.href;
                link.textContent = version.text;
                link.setAttribute("role", "menuitem");
                link.setAttribute("tabindex", "-1");

                // Mark current version
                if (
                    version.text === CONFIG.currentVersionText ||
                    (version.text === "latest" &&
                        CONFIG.currentVersionText === "latest")
                ) {
                    link.classList.add("current-version");
                    link.setAttribute("aria-current", "page");
                }

                listItem.appendChild(link);
                versionList.appendChild(listItem);
            });

            dropdown.appendChild(versionList);
            container.appendChild(toggleButton);
            container.appendChild(dropdown);

            return { container, toggleButton, dropdown, versionList };
        }

        // Add event listeners for interaction
        function addEventListeners(elements) {
            const { container, toggleButton, dropdown, versionList } = elements;
            let isOpen = false;
            let hoverTimeout;

            // Mouse enter - show dropdown
            container.addEventListener("mouseenter", () => {
                clearTimeout(hoverTimeout);
                showDropdown();
            });

            // Mouse leave - hide dropdown with delay
            container.addEventListener("mouseleave", () => {
                hoverTimeout = setTimeout(() => {
                    hideDropdown();
                }, 300);
            });

            // Click handler for toggle button
            toggleButton.addEventListener("click", (e) => {
                e.preventDefault();
                if (isOpen) {
                    hideDropdown();
                } else {
                    showDropdown();
                }
            });

            // Keyboard navigation
            container.addEventListener("keydown", (e) => {
                const links = versionList.querySelectorAll(".version-link");
                const currentFocus = document.activeElement;
                const currentIndex = Array.from(links).indexOf(currentFocus);

                switch (e.key) {
                    case "Escape":
                        hideDropdown();
                        toggleButton.focus();
                        break;
                    case "ArrowDown":
                        e.preventDefault();
                        if (!isOpen) {
                            showDropdown();
                            links[0]?.focus();
                        } else {
                            const nextIndex =
                                currentIndex < links.length - 1
                                    ? currentIndex + 1
                                    : 0;
                            links[nextIndex]?.focus();
                        }
                        break;
                    case "ArrowUp":
                        e.preventDefault();
                        if (isOpen) {
                            const prevIndex =
                                currentIndex > 0
                                    ? currentIndex - 1
                                    : links.length - 1;
                            links[prevIndex]?.focus();
                        }
                        break;
                    case "Enter":
                    case " ":
                        if (currentFocus === toggleButton) {
                            e.preventDefault();
                            if (isOpen) {
                                hideDropdown();
                            } else {
                                showDropdown();
                                links[0]?.focus();
                            }
                        }
                        break;
                }
            });

            // Click outside to close
            document.addEventListener("click", (e) => {
                if (!container.contains(e.target)) {
                    hideDropdown();
                }
            });

            function showDropdown() {
                dropdown.style.display = "block";
                toggleButton.setAttribute("aria-expanded", "true");
                toggleButton.classList.add("active");
                isOpen = true;

                // Animate in
                requestAnimationFrame(() => {
                    dropdown.style.opacity = "1";
                    dropdown.style.transform = "translateY(0)";
                });
            }

            function hideDropdown() {
                dropdown.style.opacity = "0";
                dropdown.style.transform = "translateY(-10px)";
                toggleButton.setAttribute("aria-expanded", "false");
                toggleButton.classList.remove("active");
                isOpen = false;

                setTimeout(() => {
                    dropdown.style.display = "none";
                }, 200);
            }
        }

        // Apply CSS styles
        function injectStyles() {
            const styleId = "version-switcher-styles";
            if (document.getElementById(styleId)) return;

            const styles = `
            #version-switcher {
                position: fixed;
                bottom: ${CONFIG.position.bottom};
                right: ${CONFIG.position.right};
                z-index: 9999;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                font-size: 14px;
            }

            .version-toggle-btn {
                display: flex;
                align-items: center;
                gap: 8px;
                background: rgba(255, 255, 255, 0.95);
                border: 1px solid rgba(0, 0, 0, 0.1);
                border-radius: 8px;
                padding: 10px 16px;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(10px);
                transition: all 0.2s ease;
                color: #333;
                font-weight: 500;
                min-width: 120px;
            }

            .version-toggle-btn:hover {
                background: rgba(255, 255, 255, 1);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
                transform: translateY(-2px);
                border-color: rgba(0, 109, 9, 0.3);
            }

            .version-toggle-btn.active {
                background: rgba(255, 255, 255, 1);
                border-color: #006d09;
            }

            .version-icon {
                font-size: 16px;
            }

            .version-text {
                flex: 1;
                text-align: left;
            }

            .version-arrow {
                transition: transform 0.2s ease;
                font-size: 12px;
                color: #666;
            }

            .version-toggle-btn.active .version-arrow {
                transform: rotate(180deg);
            }

            .version-dropdown {
                position: absolute;
                bottom: 100%;
                right: 0;
                margin-bottom: 8px;
                background: rgba(255, 255, 255, 0.98);
                border: 1px solid rgba(0, 0, 0, 0.1);
                border-radius: 8px;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(10px);
                opacity: 0;
                transform: translateY(-10px);
                transition: all 0.2s ease;
                min-width: 160px;
            }

            .version-list {
                list-style: none;
                margin: 0;
                padding: 8px 0;
            }

            .version-link {
                display: block;
                padding: 10px 16px;
                color: #333;
                text-decoration: none;
                transition: all 0.15s ease;
                position: relative;
            }

            .version-link:hover,
            .version-link:focus {
                background: rgba(0, 109, 9, 0.1);
                color: #006d09;
                outline: none;
            }

            .version-link.current-version {
                background: rgba(0, 109, 9, 0.1);
                color: #006d09;
                font-weight: 600;
            }

            .version-link.current-version::after {
                content: 'âœ“';
                position: absolute;
                right: 16px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 12px;
            }

            /* Dark mode support */
            @media (prefers-color-scheme: dark) {
                .version-toggle-btn {
                    background: rgba(40, 40, 40, 0.95);
                    border-color: rgba(255, 255, 255, 0.2);
                    color: #e0e0e0;
                }

                .version-toggle-btn:hover {
                    background: rgba(50, 50, 50, 1);
                    border-color: rgba(0, 180, 15, 0.5);
                }

                .version-dropdown {
                    background: rgba(40, 40, 40, 0.98);
                    border-color: rgba(255, 255, 255, 0.2);
                }

                .version-link {
                    color: #e0e0e0;
                }

                .version-link:hover,
                .version-link:focus {
                    background: rgba(0, 180, 15, 0.2);
                    color: #00b80f;
                }

                .version-link.current-version {
                    background: rgba(0, 180, 15, 0.2);
                    color: #00b80f;
                }
            }

            /* Mobile responsive */
            @media (max-width: 768px) {
                #version-switcher {
                    bottom: 15px;
                    right: 15px;
                }

                .version-toggle-btn {
                    padding: 8px 12px;
                    min-width: 100px;
                    font-size: 13px;
                }

                .version-dropdown {
                    min-width: 140px;
                }

                .version-link {
                    padding: 8px 12px;
                    font-size: 13px;
                }
            }
        `;

            const styleElement = document.createElement("style");
            styleElement.id = styleId;
            styleElement.textContent = styles;
            document.head.appendChild(styleElement);
        }

        // Initialize the version switcher
        function init() {
            // Don't initialize if already exists
            if (document.getElementById(CONFIG.containerId)) return;

            fetch(CONFIG.versionsJsonPath)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }
                    return response.json();
                })
                .then((versions) => {
                    if (!Array.isArray(versions) || versions.length === 0) {
                        console.warn("No versions found in versions.json");
                        return;
                    }

                    injectStyles();
                    const elements = createVersionSwitcher(versions);
                    addEventListeners(elements);
                    document.body.appendChild(elements.container);
                })
                .catch((error) => {
                    console.warn("Failed to load version switcher:", error);
                });
        }

        // Initialize when DOM is ready
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", init);
        } else {
            init();
        }
    })();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles/styles.css">
<meta property="og:title" content="CamlCATE â€“ CaML - Causal ML">
<meta property="og:description" content="">
<meta property="og:image" content="CamlCATE_files/figure-html/cell-15-output-3.png">
<meta property="og:site_name" content="CaML - Causal ML">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/logo_no_text.svg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">    
        <li>
    <a class="dropdown-item" href="../index.html">
 <span class="dropdown-text">Welcome!</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../01_Home/installation.html">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../01_Home/quickstart.html">
 <span class="dropdown-text">Tutorial: Quick Start</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">    
        <li>
    <a class="dropdown-item" href="../02_Concepts/motivation.html">
 <span class="dropdown-text">Motivation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../02_Concepts/theory.html">
 <span class="dropdown-text">Econometric Theory</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../02_Concepts/models.html">
 <span class="dropdown-text">Model Specifications</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-examples" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Examples</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-examples">    
        <li>
    <a class="dropdown-item" href="../03_Examples/CamlCATE.html">
 <span class="dropdown-text">CamlCATE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../03_Examples/FastOLS.html">
 <span class="dropdown-text">FastOLS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../03_Examples/SyntheticDataGenerator.html">
 <span class="dropdown-text">Caml Synthetic Data Generator</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../04_Reference/index.html">
 <span class="dropdown-text">API Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../04_Reference/support_matrix.html">
 <span class="dropdown-text">Outcome/Treatment Type Support Matrix</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contributors" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contributors</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contributors">    
        <li>
    <a class="dropdown-item" href="../05_Contributors/getting_started.html">
 <span class="dropdown-text">Contributing to CaML</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../05_Contributors/environment.html">
 <span class="dropdown-text">Environment Setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../05_Contributors/documentation.html">
 <span class="dropdown-text">Documentation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../05_Contributors/testing.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../05_Contributors/conventional_commits.html">
 <span class="dropdown-text">Conventional Commits</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jakepenzak/caml">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jakepenzak/caml/issues/new">
            Report Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03_Examples/CamlCATE.html">CamlCATE</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Examples/CamlCATE.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">CamlCATE</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Examples/FastOLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FastOLS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Examples/SyntheticDataGenerator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Caml Synthetic Data Generator</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#generate-synthetic-data" id="toc-generate-synthetic-data" class="nav-link active" data-scroll-target="#generate-synthetic-data">Generate Synthetic Data</a></li>
  <li><a href="#running-camlcate" id="toc-running-camlcate" class="nav-link" data-scroll-target="#running-camlcate">Running CamlCATE</a>
  <ul class="collapse">
  <li><a href="#class-instantiation" id="toc-class-instantiation" class="nav-link" data-scroll-target="#class-instantiation">Class Instantiation</a></li>
  <li><a href="#nuisance-function-automl" id="toc-nuisance-function-automl" class="nav-link" data-scroll-target="#nuisance-function-automl">Nuisance Function AutoML</a></li>
  <li><a href="#fit-cate-estimators" id="toc-fit-cate-estimators" class="nav-link" data-scroll-target="#fit-cate-estimators">Fit CATE Estimators</a></li>
  <li><a href="#validate-model-on-test-hold-out-set" id="toc-validate-model-on-test-hold-out-set" class="nav-link" data-scroll-target="#validate-model-on-test-hold-out-set">Validate model on test hold out set</a></li>
  <li><a href="#refit-our-selected-model-on-the-entire-dataset" id="toc-refit-our-selected-model-on-the-entire-dataset" class="nav-link" data-scroll-target="#refit-our-selected-model-on-the-entire-dataset">Refit our selected model on the entire dataset</a></li>
  </ul></li>
  <li><a href="#validating-results-with-ground-truth" id="toc-validating-results-with-ground-truth" class="nav-link" data-scroll-target="#validating-results-with-ground-truth">Validating Results with Ground Truth</a>
  <ul class="collapse">
  <li><a href="#average-treatment-effect-ate" id="toc-average-treatment-effect-ate" class="nav-link" data-scroll-target="#average-treatment-effect-ate">Average Treatment Effect (ATE)</a></li>
  <li><a href="#conditional-average-treatment-effect-cate" id="toc-conditional-average-treatment-effect-cate" class="nav-link" data-scroll-target="#conditional-average-treatment-effect-cate">Conditional Average Treatment Effect (CATE)</a></li>
  </ul></li>
  <li><a href="#obtaining-model-objects-artifacts-for-production-systems" id="toc-obtaining-model-objects-artifacts-for-production-systems" class="nav-link" data-scroll-target="#obtaining-model-objects-artifacts-for-production-systems">Obtaining Model Objects &amp; Artifacts for Production Systems</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jakepenzak/caml/edit/main/docs/03_Examples/CamlCATE.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jakepenzak/caml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CamlCATE</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Here weâ€™ll walk through an example of generating synthetic data, running <code>CamlCATE</code>, and visualizing results using the ground truth as reference.</p>
<p><code>CamlCATE</code> is particularly useful when highly accurate CATE estimation is of primary interest in the presence of exogenous treatment, simple linear confounding, or complex non-linear confounding exists.</p>
<p><code>CamlCATE</code> enables the use of various CATE models with varying assumptions on functional form of treatment effects &amp; heterogeneity. When a set of CATE models are considered, the final CATE model is automatically selected is based on validation set performance.</p>
<section id="generate-synthetic-data" class="level2">
<h2 class="anchored" data-anchor-id="generate-synthetic-data">Generate Synthetic Data</h2>
<p>Here weâ€™ll leverage the <a href="../04_Reference/SyntheticDataGenerator.html"><code>SyntheticDataGenerator</code></a> class to generate a linear synthetic data generating process, with a binary treatment, continuous outcome, and a mix of confounding/mediating continuous covariates.</p>
<div id="c874945f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml.logging <span class="im">import</span> configure_logging</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>configure_logging(level<span class="op">=</span>logging.DEBUG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[06/26/25 14:09:29] </span><span style="color: #008080; text-decoration-color: #008080">DEBUG   </span> Logging configured with level: DEBUG                                     <a href="file:///home/runner/work/caml/caml/caml/logging.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">logging.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/logging.py#70" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">70</span></a>
</pre>
</div>
</div>
<div id="f922a8a7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml.extensions.synthetic_data <span class="im">import</span> SyntheticDataGenerator</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_generator <span class="op">=</span> SyntheticDataGenerator(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    n_obs<span class="op">=</span><span class="dv">10_000</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    n_cont_outcomes<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    n_binary_treatments<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    n_cont_confounders<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    n_cont_modifiers<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    n_confounding_modifiers<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    causal_model_functional_form<span class="op">=</span><span class="st">"linear"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span><span style="color: #808000; text-decoration-color: #808000">WARNING </span> SyntheticDataGenerator is experimental and may change in future         <a href="file:///home/runner/work/caml/caml/caml/generics.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">generics.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/generics.py#44" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">44</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         versions.                                                               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre>
</div>
</div>
<p>We can print our simulated data via:</p>
<div id="03fba8a2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_generator.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">W1_continuous</th>
<th data-quarto-table-cell-role="th">W2_continuous</th>
<th data-quarto-table-cell-role="th">X1_continuous</th>
<th data-quarto-table-cell-role="th">X2_continuous</th>
<th data-quarto-table-cell-role="th">T1_binary</th>
<th data-quarto-table-cell-role="th">Y1_continuous</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.354380</td>
<td>-3.252276</td>
<td>2.715662</td>
<td>-3.578800</td>
<td>1</td>
<td>11.880305</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.568499</td>
<td>2.484069</td>
<td>-6.402235</td>
<td>-2.611815</td>
<td>0</td>
<td>-32.292141</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.162715</td>
<td>8.842902</td>
<td>1.288770</td>
<td>-3.788545</td>
<td>1</td>
<td>-48.696391</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.362944</td>
<td>-0.959538</td>
<td>1.080988</td>
<td>-3.542550</td>
<td>0</td>
<td>-1.899468</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.612101</td>
<td>1.417536</td>
<td>4.143630</td>
<td>-4.112453</td>
<td>1</td>
<td>-7.315334</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>0.340436</td>
<td>0.241095</td>
<td>-6.524222</td>
<td>-3.188783</td>
<td>1</td>
<td>-27.578609</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>0.019523</td>
<td>1.338152</td>
<td>-2.555492</td>
<td>-3.643733</td>
<td>1</td>
<td>-19.692436</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>0.325401</td>
<td>1.258659</td>
<td>-3.340546</td>
<td>-4.255203</td>
<td>1</td>
<td>-26.087316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>0.586715</td>
<td>1.263264</td>
<td>-2.826709</td>
<td>-4.149383</td>
<td>1</td>
<td>-25.876331</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>0.003002</td>
<td>6.723381</td>
<td>1.260782</td>
<td>-3.660600</td>
<td>1</td>
<td>-38.200522</td>
</tr>
</tbody>
</table>

<p>10000 rows Ã— 6 columns</p>
</div>
</div>
</div>
<p>To inspect our true data generating process, we can call <code>data_generator.dgp</code>. Furthermore, we will have our true CATEs and ATEs at our disposal via <code>data_generator.cates</code> &amp; <code>data_generator.ates</code>, respectively. Weâ€™ll use this as our source of truth for performance evaluation of our CATE estimator.</p>
<div id="4fe7671d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t, df <span class="kw">in</span> data_generator.dgp.items():</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">DGP for </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
DGP for T1_binary:
{'formula': '1 + W1_continuous + W2_continuous + X1_continuous', 'params': array([ 0.4609703 ,  0.2566887 , -0.03896251,  0.07238272]), 'noise': array([-0.51949108, -1.88624383,  0.86927397, ...,  0.87157749,
        0.0697439 , -0.72616319]), 'raw_scores': array([0.58800598, 0.13710535, 0.75412862, ..., 0.7549587 , 0.60527474,
       0.39290362]), 'function': &lt;function SyntheticDataGenerator._create_dgp_function.&lt;locals&gt;.f_binary at 0x7f50003b16c0&gt;}

DGP for Y1_continuous:
{'formula': '1 + W1_continuous + W2_continuous + X1_continuous + X2_continuous + T1_binary + T1_binary*X1_continuous + T1_binary*X2_continuous', 'params': array([ 1.11129512, -4.1263484 , -4.82709212,  1.87319625,  2.60635605,
       -0.91633948,  0.71653213, -0.25067306]), 'noise': array([-1.15370094, -0.26681987,  0.05261899, ..., -0.18887322,
       -0.45736583, -0.57057603]), 'raw_scores': array([ 11.88030508, -32.29214063, -48.69639077, ..., -26.0873159 ,
       -25.87633114, -38.20052217]), 'function': &lt;function SyntheticDataGenerator._create_dgp_function.&lt;locals&gt;.f_cont at 0x7f4ffffac280&gt;}</code></pre>
</div>
</div>
<div id="dadd2baf" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_generator.cates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CATE_of_T1_binary_on_Y1_continuous</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.926628</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-4.849035</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.956792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.746245</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.083586</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>-4.791812</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>-1.834046</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>-2.243283</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>-1.901629</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>0.904665</td>
</tr>
</tbody>
</table>

<p>10000 rows Ã— 1 columns</p>
</div>
</div>
</div>
<div id="084ab3d4" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_generator.ates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Treatment</th>
<th data-quarto-table-cell-role="th">ATE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T1_binary_on_Y1_continuous</td>
<td>-0.55937</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-camlcate" class="level2">
<h2 class="anchored" data-anchor-id="running-camlcate">Running CamlCATE</h2>
<section id="class-instantiation" class="level3">
<h3 class="anchored" data-anchor-id="class-instantiation">Class Instantiation</h3>
<p>We can instantiate and observe our CamlCATE object via:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>W</code> can be leveraged if we want to use certain covariates only in our nuisance functions to control for confounding and not in the final CATE estimator. This can be useful if a confounder may be required to include, but for compliance reasons, we donâ€™t want our CATE model to leverage this feature (e.g., gender). However, this will restrict our available CATE estimators to orthogonal learners, since metalearners necessarily include all covariates. If you donâ€™t care about <code>W</code> being in the final CATE estimator, pass it as <code>X</code>, as done below.</p>
</div>
</div>
<div id="c7b86018" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml <span class="im">import</span> CamlCATE</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>caml_obj <span class="op">=</span> CamlCATE(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>data_generator.df,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    Y<span class="op">=</span><span class="st">"Y1_continuous"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    T<span class="op">=</span><span class="st">"T1_binary"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>[c <span class="cf">for</span> c <span class="kw">in</span> data_generator.df.columns <span class="cf">if</span> <span class="st">"X"</span> <span class="kw">in</span> c]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> [c <span class="cf">for</span> c <span class="kw">in</span> data_generator.df.columns <span class="cf">if</span> <span class="st">"W"</span> <span class="kw">in</span> c],</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    discrete_treatment<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    discrete_outcome<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span><span style="color: #808000; text-decoration-color: #808000">WARNING </span> CamlCATE is experimental and may change in future versions.             <a href="file:///home/runner/work/caml/caml/caml/generics.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">generics.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/generics.py#44" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">44</span></a>
</pre>
</div>
</div>
<div id="b91380cc" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(caml_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================== CamlCATE Object ==================
Data Backend: pandas
No. of Observations: 10,000
Outcome Variable: Y1_continuous
Discrete Outcome: False
Treatment Variable: T1_binary
Discrete Treatment: True
Features/Confounders for Heterogeneity (X): ['X1_continuous', 'X2_continuous', 'W1_continuous', 'W2_continuous']
Features/Confounders as Controls (W): []
Random Seed: None
</code></pre>
</div>
</div>
</section>
<section id="nuisance-function-automl" class="level3">
<h3 class="anchored" data-anchor-id="nuisance-function-automl">Nuisance Function AutoML</h3>
<p>We can then obtain our nuisance functions / regression &amp; propensity models via Flaml AutoML:</p>
<div id="7f5dc297" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>caml_obj.auto_nuisance_functions(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    flaml_Y_kwargs<span class="op">=</span>{</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"time_budget"</span>: <span class="dv">30</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"verbose"</span>: <span class="dv">0</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"estimator_list"</span>: [<span class="st">"rf"</span>, <span class="st">"extra_tree"</span>, <span class="st">"xgb_limitdepth"</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    flaml_T_kwargs<span class="op">=</span>{</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"time_budget"</span>: <span class="dv">30</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"verbose"</span>: <span class="dv">0</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"estimator_list"</span>: [<span class="st">"rf"</span>, <span class="st">"extra_tree"</span>, <span class="st">"xgb_limitdepth"</span>],</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e01ad1f9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(caml_obj.model_Y_X_W)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(caml_obj.model_Y_X_W_T)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(caml_obj.model_T_X_W)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ExtraTreesRegressor(max_features=0.9924623662362855, max_leaf_nodes=3267,
                    n_estimators=140, n_jobs=-1, random_state=12032022)
ExtraTreesRegressor(max_features=0.9924623662362855, max_leaf_nodes=3267,
                    n_estimators=140, n_jobs=-1, random_state=12032022)
XGBClassifier(base_score=None, booster=None, callbacks=[],
              colsample_bylevel=0.9366334928584987, colsample_bynode=None,
              colsample_bytree=0.7801788111200721, device=None,
              early_stopping_rounds=None, enable_categorical=False,
              eval_metric=None, feature_types=None, gamma=None,
              grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.42324459351542365,
              max_bin=None, max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=1, max_leaves=None,
              min_child_weight=77.88614459419128, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=14,
              n_jobs=-1, num_parallel_tree=None, random_state=None, ...)</code></pre>
</div>
</div>
</section>
<section id="fit-cate-estimators" class="level3">
<h3 class="anchored" data-anchor-id="fit-cate-estimators">Fit CATE Estimators</h3>
<p>Now that we have obtained our first-stage models, we can fit our CATE estimators via:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The selected model defaults to the one with the highest <a href="https://econml.azurewebsites.net/_autosummary/econml.score.RScorer.html#econml.score.RScorer">RScore</a>. All fitted models are still accessible via the <code>cate_estimators</code> attribute and if you want to change default estimator, you can run <code>caml_obj._validation_estimator = {different_model}</code>.</p>
</div>
</div>
<blockquote class="blockquote">
<p>ðŸš€<strong>Forthcoming:</strong> Additional scoring techniques &amp; AutoML for CATE estimators is on our roadmap.</p>
</blockquote>
<div id="f5d754a4" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>caml_obj.fit_validator(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    cate_estimators<span class="op">=</span>[</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LinearDML"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CausalForestDML"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ForestDRLearner"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LinearDRLearner"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DomainAdaptationLearner"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SLearner"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TLearner"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"XLearner"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    validation_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[06/26/25 14:11:21] </span><span style="color: #008000; text-decoration-color: #008000">INFO    </span> Best Estimator: ForestDRLearner                                            <a href="file:///home/runner/work/caml/caml/caml/core/cate.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">cate.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/core/cate.py#852" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">852</span></a>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span><span style="color: #008000; text-decoration-color: #008000">INFO    </span> Estimator RScores: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'LinearDML'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4238559610152759</span>, <span style="color: #008000; text-decoration-color: #008000">'CausalForestDML'</span>:    <a href="file:///home/runner/work/caml/caml/caml/core/cate.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">cate.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/core/cate.py#853" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">853</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.42360605775749216</span>, <span style="color: #008000; text-decoration-color: #008000">'ForestDRLearner'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.42512145369888554</span>,               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">           </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         <span style="color: #008000; text-decoration-color: #008000">'LinearDRLearner'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4242228121860917</span>, <span style="color: #008000; text-decoration-color: #008000">'DomainAdaptationLearner'</span>:          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">           </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.3977816934231625</span>, <span style="color: #008000; text-decoration-color: #008000">'SLearner'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.39765837657360315</span>, <span style="color: #008000; text-decoration-color: #008000">'TLearner'</span>:           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">           </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.3704873418026987</span>, <span style="color: #008000; text-decoration-color: #008000">'XLearner'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4204625306742942</span><span style="font-weight: bold">}</span>                        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">           </span>
</pre>
</div>
</div>
<div id="cef80f97" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>caml_obj.validation_estimator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;econml.dr._drlearner.ForestDRLearner at 0x7f4ffffc2b30&gt;</code></pre>
</div>
</div>
<div id="8da3e8c4" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>caml_obj.cate_estimators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>[('LinearDML', &lt;econml.dml.dml.LinearDML at 0x7f4fff50e380&gt;),
 ('CausalForestDML',
  &lt;econml.dml.causal_forest.CausalForestDML at 0x7f4fff59d2a0&gt;),
 ('ForestDRLearner', &lt;econml.dr._drlearner.ForestDRLearner at 0x7f4ffffc2b30&gt;),
 ('LinearDRLearner', &lt;econml.dr._drlearner.LinearDRLearner at 0x7f4ffffc3400&gt;),
 ('DomainAdaptationLearner',
  &lt;econml.metalearners._metalearners.DomainAdaptationLearner at 0x7f502694c160&gt;),
 ('SLearner', &lt;econml.metalearners._metalearners.SLearner at 0x7f4ffc4c5030&gt;),
 ('TLearner', &lt;econml.metalearners._metalearners.TLearner at 0x7f4ffffc39a0&gt;),
 ('XLearner', &lt;econml.metalearners._metalearners.XLearner at 0x7f4ffffc0670&gt;)]</code></pre>
</div>
</div>
</section>
<section id="validate-model-on-test-hold-out-set" class="level3">
<h3 class="anchored" data-anchor-id="validate-model-on-test-hold-out-set">Validate model on test hold out set</h3>
<p>Here we can validate our model on the test hold out set. Currently, this is only available for when continuous outcomes and binary treatments exist.</p>
<div id="f9836dfc" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>caml_obj.validate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[06/26/25 14:11:23] </span><span style="color: #008000; text-decoration-color: #008000">INFO    </span> All validation results suggest that the model has found statistically      <a href="file:///home/runner/work/caml/caml/caml/core/cate.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">cate.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/runner/work/caml/caml/caml/core/cate.py#497" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">497</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">                    </span>         significant heterogeneity.                                                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">           </span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   treatment  blp_est  blp_se  blp_pval  qini_est  qini_se  qini_pval  autoc_est  autoc_se  autoc_pval  cal_r_squared
0          1    0.976    0.02       0.0     0.958    0.028        0.0       2.58     0.089         0.0          0.948</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-15-output-3.png" width="590" height="454" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-15-output-4.png" width="591" height="454" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-15-output-5.png" width="579" height="454" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="refit-our-selected-model-on-the-entire-dataset" class="level3">
<h3 class="anchored" data-anchor-id="refit-our-selected-model-on-the-entire-dataset">Refit our selected model on the entire dataset</h3>
<p>Now that we have selected our top performer and validated results on the test set, we can fit our final model on the entire dataset.</p>
<div id="a1f6cbd2" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>caml_obj.fit_final()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7d883b69" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>caml_obj.final_estimator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>&lt;econml.dr._drlearner.ForestDRLearner at 0x7f4fff50cbe0&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="validating-results-with-ground-truth" class="level2">
<h2 class="anchored" data-anchor-id="validating-results-with-ground-truth">Validating Results with Ground Truth</h2>
<p>First, we will obtain our predictions.</p>
<div id="084dd35f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cate_predictions <span class="op">=</span> caml_obj.predict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="average-treatment-effect-ate" class="level3">
<h3 class="anchored" data-anchor-id="average-treatment-effect-ate">Average Treatment Effect (ATE)</h3>
<p>Weâ€™ll use the <code>summarize()</code> method after obtaining our predictions above, where our the displayed mean represents our Average Treatment Effect (ATE).</p>
<div id="b0d364b0" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>caml_obj.summarize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cate_predictions_0_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>10000.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>-0.576649</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.364999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-6.681288</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-3.546351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-0.631965</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2.229679</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>6.266488</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now comparing this to our ground truth, we see the model performed well the true ATE:</p>
<div id="b92eb01b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data_generator.ates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Treatment</th>
<th data-quarto-table-cell-role="th">ATE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T1_binary_on_Y1_continuous</td>
<td>-0.55937</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conditional-average-treatment-effect-cate" class="level3">
<h3 class="anchored" data-anchor-id="conditional-average-treatment-effect-cate">Conditional Average Treatment Effect (CATE)</h3>
<p>Now we want to see how the estimator performed in modeling the true CATEs.</p>
<p>First, we can simply compute the Precision in Estimating Heterogeneous Effects (PEHE), which is simply the Root Mean Squared Error (RMSE):</p>
<div id="7ec5dbcb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> root_mean_squared_error</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>true_cates <span class="op">=</span> data_generator.cates.iloc[:, <span class="dv">0</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>root_mean_squared_error(true_cates, cate_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0.27164854729411225</code></pre>
</div>
</div>
<p>Not bad! Now letâ€™s use some visualization techniques:</p>
<div id="e723f9f2" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml.extensions.plots <span class="im">import</span> cate_true_vs_estimated_plot</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>cate_true_vs_estimated_plot(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    true_cates<span class="op">=</span>true_cates, estimated_cates<span class="op">=</span>cate_predictions</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-22-output-1.png" width="593" height="435" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f5d18c00" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml.extensions.plots <span class="im">import</span> cate_histogram_plot</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>cate_histogram_plot(true_cates<span class="op">=</span>true_cates, estimated_cates<span class="op">=</span>cate_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-23-output-1.png" width="575" height="435" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="adbef049" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caml.extensions.plots <span class="im">import</span> cate_line_plot</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>cate_line_plot(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    true_cates<span class="op">=</span>true_cates, estimated_cates<span class="op">=</span>cate_predictions, window<span class="op">=</span><span class="dv">20</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>
<figure class="figure">
<p><img src="CamlCATE_files/figure-html/cell-24-output-1.png" width="593" height="435" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Overall, we can see the model performed remarkably well!~</p>
</section>
</section>
<section id="obtaining-model-objects-artifacts-for-production-systems" class="level2">
<h2 class="anchored" data-anchor-id="obtaining-model-objects-artifacts-for-production-systems">Obtaining Model Objects &amp; Artifacts for Production Systems</h2>
<p>In many production settings, we will want to store our model, information on the features used, etc. We provide attributes that to pull key information (more to be added later as class evolves)</p>
<p>Grabbing final model object:</p>
<div id="0bac042a" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>caml_obj.final_estimator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>&lt;econml.dr._drlearner.ForestDRLearner at 0x7f4fff50cbe0&gt;</code></pre>
</div>
</div>
<p>Grabbing input features:</p>
<div id="17b8e74b" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>caml_obj.input_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>{'feature_names': ['X1_continuous',
  'X2_continuous',
  'W1_continuous',
  'W2_continuous'],
 'output_names': 'Y1_continuous',
 'treatment_names': 'T1_binary'}</code></pre>
</div>
</div>
<p>Grabbing all fitted CATE estimators:</p>
<div id="8f693c03" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>caml_obj.cate_estimators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>[('LinearDML', &lt;econml.dml.dml.LinearDML at 0x7f4fff50e380&gt;),
 ('CausalForestDML',
  &lt;econml.dml.causal_forest.CausalForestDML at 0x7f4fff59d2a0&gt;),
 ('ForestDRLearner', &lt;econml.dr._drlearner.ForestDRLearner at 0x7f4ffffc2b30&gt;),
 ('LinearDRLearner', &lt;econml.dr._drlearner.LinearDRLearner at 0x7f4ffffc3400&gt;),
 ('DomainAdaptationLearner',
  &lt;econml.metalearners._metalearners.DomainAdaptationLearner at 0x7f502694c160&gt;),
 ('SLearner', &lt;econml.metalearners._metalearners.SLearner at 0x7f4ffc4c5030&gt;),
 ('TLearner', &lt;econml.metalearners._metalearners.TLearner at 0x7f4ffffc39a0&gt;),
 ('XLearner', &lt;econml.metalearners._metalearners.XLearner at 0x7f4ffffc0670&gt;)]</code></pre>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="../03_Examples/FastOLS.html" class="pagination-link" aria-label="FastOLS">
        <span class="nav-page-text">FastOLS</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Â© Copyright 2024, Jacob Pieniazek</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jakepenzak/caml/edit/main/docs/03_Examples/CamlCATE.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jakepenzak/caml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Powered by: <a href="https://quarto.org/"><img src="../assets/external_logos/quarto.png" class="img-fluid" width="85"></a></p>
</div>
  </div>
</footer>




</body></html>